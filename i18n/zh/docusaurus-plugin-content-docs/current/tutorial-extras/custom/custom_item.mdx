---
sidebar_position: 1
mentions:
  - "jlhsr"
  - "Mcayear"
---

# è‡ªå®šä¹‰ç‰©å“

æƒ³è¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç‰©å“ï¼Œéœ€è¦åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š

1. æ’ä»¶å†…æˆåŠŸæ³¨å†Œåˆ° Nukkit-MOT
2. èµ„æºåŒ…å†…å®šä¹‰ç‰©å“è´´å›¾å‘é€ç»™å®¢æˆ·ç«¯

æ¥ä¸‹æ¥ä»¥ **ç³–æœå‰‘** ä¸ºä¾‹ï¼Œæ¼”ç¤ºè‡ªå®šä¹‰ç‰©å“çš„æ­¥éª¤ã€‚

## åœ¨æ’ä»¶ä¸­æ³¨å†Œç‰©å“

æˆ‘ä»¬æŒ‰ç…§ä»¥ä¸‹åºåˆ—å›¾è¿›è¡Œæ“ä½œ

```mermaid
sequenceDiagram
    participant Plugin
    participant ItemCustom
    participant CustomItemDefinition
    participant Item
    
    Plugin->>ItemCustom: åˆ›å»ºæ–°ç‰©å“ç±»å¹¶ç»§æ‰¿
    ItemCustom->>ItemCustom: é‡å†™getMaxStackSize()
    ItemCustom->>ItemCustom: é‡å†™scaleOffset()
    ItemCustom->>CustomItemDefinition: é‡å†™getDefinition()
    CustomItemDefinition->>CustomItemDefinition: ä½¿ç”¨æ„å»ºå™¨è®¾ç½®å±æ€§
    CustomItemDefinition-->>ItemCustom: è¿”å›CustomItemDefinition
    Plugin->>Item: registerCustomItem(æ–°ç‰©å“ç±»)
```

### åˆ›å»ºæ–°ç‰©å“çš„ç±»

åœ¨æ’ä»¶ä¸­ï¼Œæ–°å»º `CandyCaneSword` ç±»ï¼Œç»§æ‰¿ ItemCustom å¹¶é‡å†™ç›¸åº”æ–¹æ³•

```java title="custom/item/CandyCaneSword.java"
public static class CandyCaneSword extends ItemCustom {
    private static String stringId = "candy_cane_sword";
    public static String name = "ç³–æœå‰‘";

    @Override
    public int getMaxStackSize() {
        return 1;
    }

    public int scaleOffset() {
        return 32; // éœ€è¦æ˜¯16çš„å€æ•°ï¼Œå¦‚ 32ã€64ã€128
    }

    /**
     * è¯¥æ–¹æ³•è®¾ç½®è‡ªå®šä¹‰ç‰©å“çš„å®šä¹‰
     */
    @Override
    public CustomItemDefinition getDefinition() {
        return CustomItemDefinition
            .simpleBuilder(this, ItemCreativeCategory.EQUIPMENT)
            .creativeGroup("itemGroup.name.item")
            .allowOffHand(false)
            .renderOffsets(RenderOffsets.scaleOffset(scaleOffset()))
            .build();
    }

    public CandyCaneSword() {
        super(stringId, name);
    }

    @Override
    public int getMaxDurability() {
        return 500;
    }
}
```

### ItemCustom ä¸»è¦æ–¹æ³•

å¼•è‡ª [cn.nukkit.item.customitem.ItemCustom](https://github.com/MemoriesOfTime/Nukkit-MOT/blob/master/src/main/java/cn/nukkit/item/customitem/ItemCustom.java)

æˆ‘ä»¬éœ€è¦ç”¨ `@Override` æ¥é‡å†™ä¸‹é¢çš„æ–¹æ³•ã€‚

- `getMaxStackSize()`
æ–¹æ³•ç”¨äºè®¾ç½®è‡ªå®šä¹‰ç‰©å“çš„æœ€å¤§å †å æ•°é‡ã€‚

- `scaleOffset()`
æ–¹æ³•ç”¨äºè®¾ç½®è‡ªå®šä¹‰ç‰©å“çš„è´´å›¾å¤§å°ï¼Œè¿”å›å€¼éœ€è¦æ˜¯16çš„å€æ•°ï¼Œå¦‚ 32ã€64ã€128ã€‚

- `getDefinition()`
è¿”å›ä¸€ä¸ª CustomItemDefinition ç±»æ¦‚æ‹¬äº†è¯¥ç‰©å“çš„åŸºæœ¬å±æ€§ï¼Œå¦‚ æ˜¯å¦å…è®¸å‰¯æ‰‹ã€åœ¨åˆ›é€ æ çš„åˆ†ç±»ã€é™„é­”æ•ˆæœã€‚

### CustomItemDefinition ä¸»è¦æ–¹æ³•

å¼•è‡ª [cn.nukkit.item.customitem.CustomItemDefinition](https://github.com/MemoriesOfTime/Nukkit-MOT/blob/master/src/main/java/cn/nukkit/item/customitem/CustomItemDefinition.java)

#### å¸¸ç”¨æ„å»ºå™¨

- `customBuilder` è‡ªå®šä¹‰ç‰©å“çš„å®šä¹‰æ„é€ å™¨

- `simpleBuilder` ç®€å•ç‰©å“çš„æ„å»ºå™¨ ï¼ˆé»˜è®¤ä½¿ç”¨è¿™ä¸ªï¼‰

- `toolBuilder` å·¥å…·ç‰©å“çš„æ„å»ºå™¨

- `armorBuilder` ç›”ç”²ç‰©å“çš„æ„å»ºå™¨

- `edibleBuilder` é£Ÿå“çš„æ„å»ºå™¨

å…ˆä½¿ç”¨æ„å»ºå™¨è¿”å›ä¸€ä¸ª `CustomItemDefinition` ç±»

```java title="java"
CustomItemDefinition.simpleBuilder(ItemCustom item, ItemCreativeCategory creativeCategory);
```

#### å¸¸ç”¨æ–¹æ³•

ç”±äºæ–¹æ³•ç›´æ¥è¿”å› `this` å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ‰å¹³åŒ–çš„å†™æ³•ã€‚

- `allowOffHand(boolean allowOffHand)` æ˜¯å¦å…è®¸å‰¯æ‰‹æŒæœ‰ã€‚

- `handEquipped(boolean handEquipped)` æ§åˆ¶ç¬¬ä¸‰äººç§°æ‰‹æŒç‰©å“çš„æ˜¾ç¤ºæ–¹å¼ã€‚

- `foil(boolean foil)` æ˜¯å¦æœ‰é™„é­”å…‰è¾‰æ•ˆæœï¼Œæ¯”å¦‚é™„é­”ä¹¦å°±æœ‰ã€‚

- `creativeGroup(ItemCreativeGroup creativeGroup)` æ§åˆ¶è‡ªå®šä¹‰ç‰©å“åœ¨åˆ›é€ æ çš„åˆ†ç»„ï¼Œä¾‹å¦‚æ‰€æœ‰çš„é™„é­”ä¹¦éƒ½æ˜¯ `ItemCreativeGroup.ENCHANTED_BOOK` ç»„ã€‚

- `canDestroyInCreative(boolean value)` æ§åˆ¶æ‹¿è¯¥ç‰©å“çš„ç©å®¶æ˜¯å¦å¯ä»¥åœ¨åˆ›é€ æ¨¡å¼æŒ–æ˜æ–¹å—ã€‚

### ItemCreativeGroup ä¸»è¦æ–¹æ³•

å¼•è‡ª [cn.nukkit.item.customitem.data.ItemCreativeGroup](https://github.com/MemoriesOfTime/Nukkit-MOT/blob/master/src/main/java/cn/nukkit/item/customitem/data/ItemCreativeGroup.java)

### æ³¨å†Œç‰©å“

æœ€åï¼Œåœ¨æ’ä»¶å…¥å£ç±»çš„ onEnable æ–¹æ³•ä¸­æ³¨å†Œç‰©å“

```java title="ExamplePlugin.java"
import cn.nukkit.item.Item;

@Override
public void onEnable() {
    Item.registerCustomItem(CandyCaneSword.class);
}
```

## åˆ¶ä½œèµ„æºåŒ…

æ•™ç¨‹å°†æŒ‡å¯¼æ‚¨å¦‚ä½•åˆ¶ä½œèµ„æºåŒ…ï¼Œç¡®ä¿æ­£ç¡®æŒ‡å‘ç‰©å“è´´å›¾ï¼Œä»¥åœ¨æ¸¸æˆå†…æ­£ç¡®æ˜¾è‡ªå®šä¹‰ç‰©å“ã€‚

å¦‚æœåœ¨æ¸¸æˆå†…åˆ›é€ ç‰©å“æ ä¸­ä»ç„¶çœ‹åˆ°ç©ºç™½æ ¼å­ï¼Œè¯·æ£€æŸ¥èµ„æºåŒ…é…ç½®å’Œç‰©å“è´´å›¾è·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚

è¯¦ç»†æ­¥éª¤åŒ…æ‹¬ï¼š

1. å®šä¹‰èµ„æºåŒ…çš„ UUID å’Œä¿¡æ¯ã€‚
2. åœ¨èµ„æºåŒ…ä¸­å®šä¹‰ç‰©å“è´´å›¾è·¯å¾„ã€‚
3. æ‰“åŒ…èµ„æºåŒ…å¹¶æ”¾å…¥æœåŠ¡å™¨çš„ resource_packs æ–‡ä»¶å¤¹ã€‚

### èµ„æºåŒ…ç›®å½•æ„æˆ

èµ„æºåŒ…ç›®å½•åº”è¯¥åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```mermaid
graph TD;
    RP("ğŸ“ Resource Pack") --> manifest["ğŸ“„ manifest.json"];
    RP --> pack_icon["ğŸ“„ pack_icon.png"];
    RP --> textures("ğŸ“ textures");
    textures --> item_texture["ğŸ“„ item_texture.json"];
    RP --> items("ğŸ“ items");
    items --> candy_cane_sword["ğŸ“„ candy_cane_sword.png"];
```

### manifest.json

å‚è€ƒ Bedrock Wiki å¯¹ [RP Manifest](https://wiki.bedrock.dev/guide/project-setup.html#rp-manifest) çš„è®²è§£ã€‚

```json title="RP/manifest.json"
{
    "format_version": 2,
    "header": {
        "description": "BY.nukkit-mot",
        "name": "Â§7æµ‹è¯•èµ„æºåŒ…",
        "uuid": "00000000-0000-0000-0000-000020160300",
        "version": [1, 1, 6],
        "min_engine_version": [1, 14, 0]
    },
    "modules": [
        {
            "type": "resources",
            "uuid": "dde211f9-e1a6-435e-9a84-06fa9242f63e",
            "version": [1, 0, 0]
        }
    ]
}
```

### item_texture.json

```json title="RP/textures/item_texture.json"
{
    "resource_pack_name": "nukkit-mot",
    "texture_name": "atlas.items",
    "texture_data": {
        // highlight-start
        "candy_cane_sword": {
            "textures": "textures/items/candy_cane_sword"
        }
        // highlight-end
    }
}
```

æ‰“åŒ…å¥½èµ„æºåŒ…

æ”¾å…¥æœåŠ¡å™¨çš„ `resource_packs` æ–‡ä»¶å¤¹

è¿›å…¥æœåŠ¡å™¨ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ‚¨ä¼šçœ‹è§èµ„æºåŒ…æ­£å¸¸æ˜¾ç¤º

:::note

æ‰“åŒ…èµ„æºåŒ…æ—¶æ˜¯ä»¥æ ¹ç›®å½•è¿›è¡Œæ‰“åŒ…ï¼Œå¦åˆ™å®¢æˆ·ç«¯æ— æ³•è¯»å–èµ„æºåŒ…ã€‚

æ ¹ç›®å½•æŒ‡çš„æ˜¯ï¼Œä¸ `manifest.json` æ–‡ä»¶åŒçº§çš„ç›®å½•ã€‚

:::

## æ·±å…¥äº†è§£

### ä¸ Bedrock Wiki çš„å¯¹ç…§å…³ç³»

å¦‚æœ CustomItemDefinition ä¸­æ²¡æœ‰æ‚¨æƒ³è¦çš„å°è£…æ–¹æ³•ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ç›´æ¥å‚ç…§ Bedrock Wiki çš„ [ItemComponents](https://wiki.bedrock.dev/items/item-components.html) æ–‡æ¡£ï¼

ä»¥å…è®¸å‰¯æ‰‹ä¸¾ä¾‹ã€‚

åœ¨ Nukkit-MOT çš„ [CustomItemDefinition](https://github.com/MemoriesOfTime/Nukkit-MOT/blob/master/src/main/java/cn/nukkit/item/customitem/CustomItemDefinition.java#L203) ç±»ä¸­çš„å†…å®¹å¦‚ä¸‹

```java
public class CustomItemDefinition {
    public static class SimpleBuilder {
        /**
         * æ˜¯å¦å…è®¸å‰¯æ‰‹æŒæœ‰
         */
        public SimpleBuilder allowOffHand(boolean allowOffHand) {
            this.nbt.getCompound("components")
                    .getCompound("item_properties")
                    .putBoolean("allow_off_hand", allowOffHand);
            return this;
        }
    }
}
```

è€Œ Bedrock Wiki ä¸­æ˜¯è¿™ä¹ˆä»‹ç» [Allow Off Hand](https://wiki.bedrock.dev/items/item-components.html#allow-off-hand) çš„ï¼š

```md
## Allow Off Hand

Determines whether an item can be placed in the off-hand slot of the inventory.
```
```java title="minecraft:item > components"
"minecraft:allow_off_hand": {
    "value": true
}
```

SimpleBuilder#allowOffHand æ–¹æ³•ä¸­çš„ `this.nbt` åœ¨æ„å»ºå™¨ä¸­è¢«åˆ›å»ºï¼Œå¯å‚è€ƒ Nukkit-MOT çš„ [CustomItemDefinition.java#L171](https://github.com/MemoriesOfTime/Nukkit-MOT/blob/master/src/main/java/cn/nukkit/item/customitem/CustomItemDefinition.java#L171)

```java
    public static class SimpleBuilder {
        protected final CompoundTag nbt = new CompoundTag()
                .putCompound("components", new CompoundTag()
                        .putCompound("item_properties", new CompoundTag()
                                .putCompound("minecraft:icon", new CompoundTag())
                        )
                );
    }
```

:::note

å¹¶ä¸æ˜¯æ‰€æœ‰æ–¹æ³•éƒ½èƒ½é€šè¿‡ç®€å•çš„æ·»åŠ  nbt å°±è¾¾æˆå…¶æ•ˆæœçš„ï¼Œè­¬å¦‚ `minecraft:cooldown` å°±éœ€è¦æœåŠ¡å™¨æ¥å¤„ç† `PlayerStartItemCoolDownPacket` ä»¥å®ç°ç‰©å“çš„ä½¿ç”¨å†·å´è¡Œä¸ºã€‚

å¯ä»¥åœ¨ [cn.nukkit.network.protocol.ProtocolInfo](https://github.com/MemoriesOfTime/Nukkit-MOT/blob/master/src/main/java/cn/nukkit/network/protocol/ProtocolInfo.java) ä¸­æŸ¥çœ‹åè®®æ”¯æŒçš„æ‰€æœ‰æ•°æ®åŒ…ã€‚

:::